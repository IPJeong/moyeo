<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<!--  
<mapper namespace="패키지명.인터페이스">

-->
<mapper namespace="com.engineers.moyeo.main.dao.MainDAO">  <!-- 인터페이스 -->
    
    <select id="idCheck" parameterType="String" resultType="int">
		SELECT COUNT(*) 
		  FROM member_info 
		 WHERE mem_id= #{mem_id}
	</select>
	
	<!-- 비밀번호 체크 -->
	<select id="pwdCheck" parameterType="Map" resultType="int">
		SELECT COUNT(*) 
		  FROM member_info 
		 WHERE mem_id= #{mem_id} AND passwd = #{passwd}
	</select>
	
	<!-- 임시비밀번호 체크 -->
	<select id="tempPwdCheck" parameterType="Map" resultType="int">
		SELECT COUNT(*) 
		  FROM temppasswd_list 
		 WHERE mem_id= #{mem_id} AND temp_passwd = #{passwd}
	</select>
	
	<!-- 워드 클라우드 단어를 가져옴 -->
	<select id="getWordCloudModel" resultType="com.engineers.moyeo.main.dto.WordDTO">
		SELECT *
	      FROM (
				SELECT word, count, part_of_speech, update_date, reg_date, rownum as rn
				  FROM (SELECT *
                          FROM wordcloud_list
                 		 ORDER BY count DESC, update_date DESC, reg_date DESC
                        )				 
         		)
    	 WHERE rn BETWEEN 1 AND 30 
	</select>
	
	<!-- 워드 클라우드 단어를 확인 -->
	<select id="checkWordCloud" parameterType="String" resultType="int">
		SELECT COUNT(*)
		  FROM wordcloud_list
		 WHERE word = #{word}
	</select>
	
	<!-- 워드 클라우드 단어를 삽입 시킴 -->
	<insert id="addWordCloud" parameterType="com.engineers.moyeo.main.dto.WordDTO">
		INSERT INTO wordcloud_list (word, count, part_of_speech, update_date, reg_date) 
							VALUES (#{word}, #{count}, #{part_of_speech}, #{update_date}, #{reg_date})
	</insert>
	
	<!-- 워드 클라우드 단어를 업데이트 시킴 -->
	<update id="updateWordCloud" parameterType="com.engineers.moyeo.main.dto.WordDTO">
		UPDATE wordcloud_list
		   SET count = count + #{count},
		       update_date = #{update_date}
		 WHERE word = #{word}   
	</update>
	
	<!-- 워드클라우드 단어 검색 -->
	<select id="searchWordcloud" parameterType="Map" resultType="com.engineers.moyeo.main.dto.WordDTO">
		SELECT *
	      FROM (
				SELECT word, count, part_of_speech, update_date, reg_date, rownum as rn
				  FROM (
				  		SELECT *
                          FROM wordcloud_list
                 		 ORDER BY count DESC
                        )
                  WHERE 
                  <if test="type == 1">
                  	part_of_speech = 'Noun' OR part_of_speech = 'ProperNoun'
                  </if>
                  <if test="type == 2">
                  	part_of_speech = 'Verb'
                  </if>
                  <if test="type == 3">
                  	part_of_speech = 'Hashtag'
                  </if>
                  <if test="type == 4">
                  	part_of_speech = 'Noun' OR part_of_speech = 'ProperNoun' OR part_of_speech = 'Verb'
                  </if>
                  <if test="type == 5">
                  	part_of_speech = 'Verb' OR part_of_speech = 'Hashtag'
                  </if>
                  <if test="type == 6">
                  	part_of_speech = 'Noun' OR part_of_speech = 'ProperNoun' OR part_of_speech = 'Hashtag'
                  </if>
                  <if test="type == 7">
                  	part_of_speech = 'Noun' OR part_of_speech = 'ProperNoun' OR part_of_speech = 'Verb' OR part_of_speech = 'Hashtag'
                  </if>
                  <if test="strDate != null">
                  	AND update_date &gt; = #{strDate} AND update_date &lt;= #{endDate}
                  </if>
         		)
    	 WHERE rn BETWEEN 1 AND #{countOfWords} 
	</select>
</mapper>